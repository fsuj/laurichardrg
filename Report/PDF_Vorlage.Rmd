---
title: Comparison of image matching algorithms for rock glacier displacement mapping. A case study for the Laurichard rock glacier, French Alps. 
author: 
- Florian Strohmaier, Stefan Werner
- Dozentin Prof. Schmullius, Dr. Biskop
#date: "`r format(Sys.time(), '%d %B %Y')`"
date: "July 11 2018"
header-includes:
# - \usepackage[ngerman]{babel}
  - \usepackage[document]{ragged2e}
  - \usepackage{caption}
output:
  pdf_document: 
    #toc: TRUE
    number_sections: yes
    #     pandoc_args: [
    #   "-V", "classoption=twocolumn"
    # ]
  html_document: default
link-citations: yes
bibliography: [bib20180620.bib,Rpackages.bib]
subtitle: Geo 411 - Landschaftsmanagement und Fernerkundung
#biblio-style: apalike
fontsize: 10.5pt
geometry: "left=4cm, right=3cm, top=2.5cm, bottom=2.5cm" #, margin = 1.2in" 
linestretch:  1.5



# abstract: "Dieser Handzettel soll einen Überblick Über die R Pakete **raster** (@R-raster) und **stars** (@R-stars) geben sowie die aktuellen Entwicklungen zur Rasterprozessierung in R aufzeigen."

# <br /> 
# @Hijmans.2017d
# \newpage
# \newline
# ** FETT**
# * kursiv *
# * Aufzählung
# * Aufzählung
#   + Unterpunkt
# @Holzworth.2018b
#
#
# ```{r echo=FALSE, fig.pos="h",fig.align="center", out.width = "150px", fig.cap= "NetCDF- Datenstruktur Davis(2014)"}
# knitr::include_graphics("netcdf-file-structure.png")
# ```
# 
#```{r packages-tab2,echo=FALSE, warning=FALSE, message=FALSE}
#library(dplyr)
#library(knitr)
#library(kableExtra)
#text_tbl = read.csv(file = "tables/SDG_Goals_final.csv",header = T,sep = ";")
# knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "17 SDG's (UN.2015b)") %>% 
#    kableExtra::kable_styling(full_width = F, font_size = 11 , latex_options = c("striped","hold_position","scale_down"))%>%
#   column_spec(1, bold = TRUE) %>%  #color = "blue"
#   column_spec(2, width = "14.5cm") %>%
#   row_spec(0, bold = TRUE)
#```
#
# $$\phi$$ Formel
# $\phi$ inline Formel


---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\pagenumbering{gobble} 
\centering
\raggedright
\newpage
\tableofcontents
\newpage
\justify
\pagenumbering{arabic} 
\captionsetup[figure]{name=Figure}
\captionsetup[table]{name=Table}


# Introduction
\vspace{-0.5cm}
Rock glaciers are distinctive morphological features of high mountain periglacial environments. Their deformation processes are strongly linked to permafrost degradation [@haeberli_mountain_2010]. Thus, research of deformation velocities of rock glaciers does not only provide insights into periglacial morphology but also in time evolution of permafrost. Several authors have used rock glaciers as proxies for permafrost presence/absence in permafrost distribution models [@boeckli_statistical_2012,@marcer_permafrost_2017].

In recent years, multi-method approaches have been used in this field of research; @buchli_kinematic_2018 combine laser scanning, terrestrial radar and in-situ measurements at the Furggwanghorn rock glacier in Switzerland. Remote sensing data, especially radar interferometry (InSAR) [@barboux_mapping_2015], optical imagery and laser scanning [@arenson_detection_2016] have become more and more common for rock glacier deformation analysis. With unmanned aerial vehicles (UAVs), high-resolution consumer grade digital cameras and smartphones being more and more widespread, surveys with high to very high resolution in time and space dimensions [@dallasta_unmanned_2017] become affordable in research and natural hazard mitigation contexts. Structure-from-motion (SfM) [@smith_structure_2016] and other established photogrammetric techniques allow for the generation of genuine 3D point clouds as well as 2.5D digital surface models (DSMs) and derivates, acquired by abovementioned techniques [@eltner_imagebased_2016].

<!-- From a series of those surface models at different points in time, displacement velocities of mass movement processes as well as surface changes resulting from erosion and denudation can be quantified. Techniques range from simple DEM differencing to 3-dimensional point-cloud comparison [@james_3d_2017]. -->

Image matching techniques are well established methods for the quantification of surface changes in geomorphology and glaciology [@paul_glaciers_2015]. All image matching algorithms are based on the comparison of either local image patterns or structures/features, on global image characteristics or a combination thereof. They can be applied to panchromatic or colour images as well as to DEMs and their derivates and image transformations (most commonly used: Fourier transformations, filters and principal component analyses) [@heid_evaluation_2012,@dallasta_unmanned_2017]. Besides scope and input data, image matching algorithms can be structured by their similarity measure: The calculation of a normalized cross-correlation coefficient (NCC) on two image parts is the most widespread measure [@scambos_application_1992]. More recently, NCC-based similarity measures have been developed further, being based on image derivatives [@heid_evaluation_2012] or on global energy functions [@argandacarreras_consistent_2006].

<!-- They have already been developed for glacier velocity analyses in the mid-1980s [@scambos_application_1992] and have been developed further since then. They do not necessarily depend on elevation models, except for the quantification of 3-dimensional (i.e. elevation) differences. -->

Image matching techniques have been applied to rock glacier deformation detection and the calculation of velocity fields. @bodin_multi-annual_2018 present one of the most recent examples for the Laurichard rock glacier in the French Alps. Based on their work, we compared the performance of two image matching algorithms for surface displacement detection between 2012 and 2017: 
1. The well-established IMCORR algorithm [@nsidc_imcorr_2018], based on @scambos_application_1992; and 
2. bUnwarpJ, a semi-global algorithm originally developed for image registration in health studies [@argandacarreras_consistent_2006].
For both algorithms we calculated an annual displacement rate of the Laurichard rock glacier, based on high-resolution DEMs from an aerial laser scanning (ALS) campaign in 2012 and from a UAV campaign in 2017. We optimized parameter settings of both approaches and estimated the accuracy of the resulting deformation fields with GPS displacement data from @bodin_multi-annual_2018 and manually mapped surface displacements.


# Study Area
\vspace{-0.5cm}
The Laurichard rock glacier is situated in the French Alps, with an approximately 800m long and 100-200m wide tounge flowing from south to north-east. Due to its morphological features it can be considered an active rock glacier [@bodin_multi-annual_2018]. Especially, hillshades generated from available digital elevation models (DEMs) exhibit scarps, oriented perpendicular to the flow direction as well as a steep rising frontal lobe (figure \ref{fig:area}).

<!-- Since the beginning of the 1980s, the Laurichard rock glacier has been subject to in-situ and remote sensing photogrammetry research. Refer to @bodin_multi-annual_2018 for the most current research work as well as for an overview over the history of site studies. -->

```{r area, echo=FALSE, fig.pos="h",fig.align="center", out.width = "300px", fig.cap= "Study Site: Laurichard rock glacier is situated in the French Alps"}
knitr::include_graphics("images/Map_1.png")
```

# Data and Methods
\vspace{-0.5cm}
## Used Data and Preprocessing

\vspace{-0.5cm}
To compare the rock glacier's annual displacement rates we used one DEM, acquired by an ALS survey on 16./17. August 2012 with a vertical accuracy of 0.02m  [@bodin_multi-annual_2018]. The second DEM is derived from a UAV survey in 2017 and processed by Structure-from-Motion techniques (Jason Goetz (JG), personal communication). Both models have been georeferenced and resampled to a 0.1m resolution, but have not been co-registered (JG, personal communication). A first inspection with simple DEM differencing (DoD) showed good accordance between the two data sets in supposedly stable areas around the Laurichard rock glacier. Therefore, we decided to omit a co-registration procedure.

From the DEMs we derived Slope, Aspect and Hillshade with GIS standard settings as well as a principle component analysis (PCA) of DEM, Hillshade, Aspect and Slope in order to compare algorithm performance based on different input data. We created a rock glacier contour to mask the Laurichard rock glacier from surrounding stable areas.

As validation data we used 3-dimensional annual displacement rates from 2012-2015, derived from a long-term survey (since 1992) of total station and DGPS measurements of 18 marked blocks [@bodin_multi-annual_2018]. Additionally, we manually mapped 31 identifiable features from the 2012 and 2017 hillshades on the rock glacier itself, by using the landmark function of the BUnwarpJ plugin in ImageJ/Fiji (see the following section).

<!-- TODO: brauchen wir das echt?? Expert Based Validation Dataset (Points from ImageJ (Source, Target), Calculate euclidian Distanz -> Calculate XYZ Displacment (Extract Height from Source Image at Source Point, Target Image at Target Point, Make difference (TargetHeight- SourceHeight, Calcilate XYZ with sqrt((XY_Displacement)^2 +(Z_Displacement)^2))) ) -->

## BUnwarpJ plugin for ImageJ
\vspace{-0.5cm}
ImageJ [@rueden_imagej2_2017] and its package bundle Fiji [@schindelin_fiji_2012] have been developed for biological and medical image analysis. The plugin BUnwarpJ [@argandacarreras_consistent_2006] performs "2D image registration based on elastic deformation" [@argandacarreras_bunwarpj_2017] between two images. The image registration algorithm calculates a deformation matrix represented by cubic B-splines from an optimization of global (energy functions describing the dissimilarity of two images) and local (user-identified feature tracking) image characteristics. Terms in the optimization equation system are weighted; thus, the importance of global and local image characteristics can be weighted by the user [@argandacarreras_consistent_2006].
$$E=\omega_{i\ }E_{img}\ +\ \omega_{\mu}\ E_{\mu}\ +\left(\omega_{d\ }E_{div}\ +\omega_{r\ }E_{rot}\right)\ +\omega_{c\ }E_{cons}$$
with $E_\mu$ being an optional landmark constraint, ($E_{div} + E_{rot}$) a regularization term, ($E_{cons}$) being an energy term, accounting for the geometrical consistency for the elastic deformation, and $\omega$ weightings that can be set by the user.

<!-- In the intended use of BUnwarpJ, the resulting deformation field is used for co-registering images with one reference image. While this application can also be employed in remote sensing applications, we considered the resulting B-spline deformation field as the displacement velocity information. To the authors' knowledge, BUnwrapJ in ImageJ distributions has hardly been used yet in geomorphological applications (JG, personal communication). -->
 
## IMCORR
\vspace{-0.5cm}

Image correlation algorithms are well-established methods in image matching and feature tracking, originally developed for glacier velocity analyses [@scambos_application_1992]. In general, algorithms compute a normalized correlation coefficient (NCC) as a similarity metric of two bounded image areas: For a reference window (chip) of image 1 the NCC between image 1 and image 2 is calculated within a search chip of image 2. The distance between the center of the reference window in image 1 and the center of the maximum NCC results in a deformation vector [@debella-gilo_sub-pixel_2011]. Correlation metrics as well as input data have been developed further in recent years [@heid_evaluation_2012].

## Algorithm Comparison
\vspace{-0.5cm}

For BUwarpJ, we manually set 61 landmarks in the compared images in order to identify features of local deformations on the rock glacier surface as well as in stable areas. In order to analyse the sensitivity of the BUnwarpJ optimization algorithm, we varied
1. the landmark input set by excluding one one boulder with an extraordinarily high movement rate at the rock glacier front lobe (61 vs. 60 landmarks as input data) and landmarks indicating rock fall from a wall in order to analyze the influence of extreme deformation/velocity values, i.e. surface deformation caused by rockfall;
2. input images (DEM, HILL, ASPECT, SLOPE, PCA1); and
3. the weights of global and local (landmarks) image characteristics, ranging in a scale from 4:0 to 0:4.

We used only the better performing landmark for the comparison of different image data and a shift in weights from local to global optimization algorithm terms. The areal transformation output resulting from varying input data and BUnwarpJ settings could be used for the calculation of 3-dimensional displacement, based on the 2012 DEM.

In IMCORR, we used an algorithm performing a matching on Fourier transformed input images on user-selected reference and search window sizes (16 to 128 and 16 to 256 pixels, respectively) [@nsidc_imcorr_2018]. From @bodin_multi-annual_2018 we assumed an average displacement of around 2m per year; by reasoning, we compared only search window sizes of 12.8m (reference chip size 6.4m) and 25.6m (reference chip size of 6.4m and 12.8m) for 3-dimensional displacements to analyze the importance of search and reference chip sizes and therefore of assumptions prior to the algorithm application. Due to computational reasons, we omitted a comparison of different input data sets. We extracted the start points of the resulting displacement vector field and interpolated the point data to areal data (inverse distance weighting with a local search distance of 10m and Gaussian weighting with 10m bandwidth) according to @bodin_multi-annual_2018.

We applied an aspect-correction (-60° to 60°) of the deformation values of both algorithms and masked the resulting interpolated deformation velocity fields as well as the two validation data sets, excluding stable areas, a steep rock wall and obviously striped data in the 2012 DEM from the validation procedure. We compared the resulting deformation fields to the deformations measured by @bodin_multi-annual_2018 on 18 marked blocks with GPS measurements and to the manually mapped deformations between identifiable features of the 2012 and 2017 hillshades. We used R² as measure of agreement and RMSE as error measure.

<!-- ; both are dependent on the mean as 1st moment and therefore prone to outliers. Because the validation data sets comprised only limited numbers of points, we also analyzed performance metrics based on the median (quartile ranges). -->

We chose only the best performing resulting deformation fields of each algorithm for a comparison of BUnwarpJ and IMCORR. We analyzed performance metrics as well as the visual accordance with the results of @bodin_multi-annual_2018.

<!-- * Decision to to test with ImageJ (time) -->
<!-- * TODO: Masking Aspect und Mask, causes the loss of Validation points (NA) -->
<!-- * Test setup -->
<!--   + Test I: Testing the difference of Landmarks (60/61), landmark on falling rock (yes/no), see map for study site, decision which Landmarks we gonna use -->
<!--   + Test II: Testing Different Input Data (DEM,HILL,ASPECT,SLOPE;PCA1) for Transformation BunwarpJ, all applied to DEM, decision which input data  we gonna use for Transformation -->
<!--   + Test III: Testing different Setting, Name LMW/IMW (Landmarkweight/imageweight), decision final processing settings -->
<!--   + Test IV: three different Settings for IMCORR, to much time, future research sample TestSetup like bunwrappJ (with out Landmarks) -->

We used the versions Fiji ImageJ 1.52d and BUnwarpJ 2.6, the IMCORR -- Feature Tracking and Inverse Distance Weighted tools implemented in SAGA GIS version 2.3.1 [@conrad_system_2015] as well as R version 3.4.4 [@base] and R Studio Version 1.1.453 [@rstudio] for our analysis.

# Results
\vspace{-0.5cm}
## BUnwarpJ settings
\vspace{-0.5cm}

Test I: A visual comparison of different sets of landmarks clearly showed that single landmarks can highly influence the resulting deformation field (figure \ref{fig:landmarks}). Test results are in accordance with this finding. Using 60 landmarks excluding one higly influential boulder, outperformed the 61-landmark data set in comparison with both validation data sets, resulting in an R² of 0.7115 and 0.7063 compared to an R² of 0.0499 and 0.5892, respectively. The RMSE was also lower for the 60 data set (RMSE 0.57/0.2414) than including a far travelling boulder (RMSE 0.847/0.291) (Table \ref{tab:bunwarp_landmarks} in Appendix).

```{r landmarks,echo=FALSE, fig.pos="h",fig.align="center", out.width = "500px", fig.cap= "Influence of extreme Landmarks"}
knitr::include_graphics("images/Map_2.png")
```

<!-- ## Test II  -->

Test II: Testing different input data shows that Aspect (R² 0.4926, RMSE 0.6555) and Slope (R² 0.5379, RMSE 0.5881) are less suitable than the usage of an Hillshade (R² 0.6802, RMSE 0.5656) or a DEM (R² 0.7115, RMSE 0.57) when validating with GPS-measured boulders at the rock glacier surface. The results using a PCA result in an R² of 0.6322 but a lesser RMSE of 0.5211. Validation with expert-based, manually mapped deformations shows similar results: Aspect and Slope are less suitable, but DEM (R² 0.7063, RMSE 0.2414) and the PCA data set (R² 0.681, RMSE 0.2585) seem to be more accurate than a Hillshade input data set (R² 0.6099, RMSE 0.3056) (Table \ref{tab:bunwarp_data} in Appendix).

<!-- Testing different input Data for Transformation Creation with 60 Landmark, Result from Test 1, not sure if we really need the "Error" in all the tables -->

<!-- * The Results are showing -->
<!--   + Valdidation Bodin -->
<!--     + Aspect ( R² = 0.4926, RMSE = 0.6555) and Slope ( R² = 0.5379, RMSE = 0.5881) are not really suitable to Create the Transformation ( make sense) -->
<!--     + Hillshade ( R² = 0.6802, RMSE = 0.5656) and PC1 ( R² = 0.6322, RMSE = 0.5211) are showing nearly identical Results, can be used -->
<!--     + DEM (R² 0.7115, RMSE = 0.57) is the best option (but not significant) -->
<!--   + Exepert Based -->
<!--     + Aspect (R² = 0.5637, RMSE = 0.3162) and Slope ( R² = 0.5594, RMSE = 0.32) are not really suitable to Create the Transformation ( make sense) -->
<!--     + Hillshade (R² = 0.6099, RMSE = 0.3056), less accourate than bodin -->
<!--     + DEM (R² = 0.7063, RMSE = 0.2414) and PC1(R²0.681, RMSE = 0.2585) are showing nearly identical Results, both can ne used -->
<!-- * I thing here we dont have to pay attention to the min max and so on, i think we shoot look on that at the final results -->
<!-- * Explenation and drawing conclusion see diskussion -->

<!-- ## Test III -->

Test III: The test of weighting combinations clearly shows that local image characteristics are of greater importance than global image characteristics. While a weighting of 1:1 gives best results for R² (0.7115 and 0.7063), weightings of 1:0 and 2:1 to 4:1 significantly outperform weightings of 1:2 to 1:4 in terms of R² and RMSE (Table \ref{tab:bunwarp_weights} in Appendix). In general, RMSE for the expert based validation is significantly lower than RMSE values for reference data of [@bodin_multi-annual_2018].

<!-- Testing different Settings of ImageJ, the Seetings are part of the Name -> Bsp. T3_DEM_60_[4_1]xyzDispAnual, the 4 is the Landmarkweight and the 1 The image weight -->

<!-- * The Results show -->
<!--   + tested combinations, 4_1,2_1,1_1,1_0,0_0,0_1,0_2,0_4, in gernerall -->
<!--     + combination 0_0 = useless -->
<!--     + combination 0_1 = also useless (Standart Setting of Bunwarp) -->
<!--     + combination 1_[2:4] = more or less useless -->
<!--     + combinaiton [2:4]_1 = showing good results -->
<!--     + combination 1_1 = showing best results, about as good as [2:4]_1 -->
<!--   + Trends: -->
<!--     + better results for 1_2 or 2_1 Settings in comparison to 1_4 and 4_1 -->
<!--     + Landmarkweight (4_1,2_1) showing significant better results than Imageweight -->
<!--     + Trade of beetween LMW and IMW (1_1), is showing the best result -->
<!--   + conclusion: -->
<!--     + Use 1_1 (or high landmarkweight is also ok) -->
<!--   + RMSE of Expert based Validition is lower than Bodin ( Test 1,2 confirmed) -->

<!-- * I thing here we dont have to pay attention to the min max and so on, i think we shoot look on that at the final results -->
<!-- * Explenation and drawing conclusion see diskussion -->

## IMCORR settings
\vspace{-0.5cm}

Test IV: Testing search/reference chip sizes of 128/64, 256/64 and 256/128 in IMCORR, parameter combinations with a search chip size of 256 pixels (25.6m) significantly outperform the 128/64 combination. While the validation with GPS-referenced blocks results in R² of 0.78 for 256/64 (RMSE 0.3479) compared to an R² of 0.6321 for 256/128 (RMSE 0.5097), both combinations perform similarly when validated with the expert-based data set (R² 0.8748, RMSE 0.1722 for 256/128 and R² 0.865, RSME 0.2053 for 256/64, respectively). Because of the small difference in the latter case, we chose the 256/64 for comparison with the BUnwarpJ algorithm (Table \ref{tab:imcorr} in Appendix).

<!-- Testing different Windowsizes, 128_64, 256_128, 256_64 -->

<!-- * The Results show -->
<!--   + The lowest correlation and RMSE we are achieving with 128_64 -->
<!--   + For 256_128 and 256_64 we are getting significant better R² and RMSE's -->
<!--   + Compariosn 256_128 vs. 256_64 -->
<!--     + Bodin et al. -->
<!--       + 256_128 (R² = 0.6321, RMSE = 0.5097) and 256_64 (R² = 0.78, RMSE = 0.3479), in this Case 256_64 showing significant better Results -->
<!--     + Expert based -->
<!--       + 256_128 (R² = 0.8748, RMSE = 0.1722) ans 265_64 (R² = 0.865, RSME = 0.2053), in this Case 256_128 showing slitly better Results, but not significant -->
<!--     + Bodin vs. Expert based -->
<!--       + Expert based is showing significant better Results (R², RMSE) -->
<!--     + conclusion -->
<!--       + Using 256_64, best for Bodin and "best" for Expert based (no sigfnificant difference) -->
<!-- * I thing here we dont have to pay attention to the min max and so on, i think we shoot look on that at the final results -->
<!-- * Explenation and drawing conclusion see diskussion -->


## Algorithm comparison
\vspace{-0.5cm}

From those results, we chose
1. DEM as input data with 60 landmarks and a weighting of landmarks and global image characteristics of 1:1 for BUnwarpJ; and
2. DEM as input data with a 256/64 search/reference chip size for IMCORR
for a comparison of algorithm performance.

With the BUnwarpJ results, we could identify two relatively isolated main areas of displacement, located on the rock glacier tongue. BUnwarpJ identified hardly any displacement at the steep front lobe. IMCORR results in similar displacement velocities along the whole tongue with a peak of displacement at the front lobe. We consider the displacements at the tongue resulting from both algorithms to be in good accordance with results from previous work [@bodin_multi-annual_2018]. However, BUnwarpJ displacement areas are rather isolated while IMCORR exhibits large displacement at the rock glacier front and potential errors in areas of rockfall (figure \ref{fig:compare}).

BUnwarpJ results in an overall mean annual displacement of 0.68m (sigma of 0.37m) and a median annual displacement of 0.64m (interquartile range IQR of 0.58m). IMCORR results in higher mean annual displacement rates of TODO m (sigma of 0.51m) and a higher median of 0.87m (IQR of 0.9m). We find the results to differ accordingly in maximum annual displacements of 1.72m and TODO m, respectively (table \ref{tab:compare_stats}).

IMCORR results with an R² of 0.78 (RMSE 0.3479) seem to be more in accordance with the reference data of @bodin_multi-annual_2018, compared to BUnwarpJ results with R² of 0.7115 (RMSE 0.57). A validation with manually mapped displacements results in an R² of 0.865 (RSME 0.2053) for IMCORR and an R² of 0.7063 (RMSE 0.2414) for BUnwarpJ. BUnwarpJ slightly underestimates the reference values of both validation data sets, while single displacement values of IMCORR overestimate the reference data (figure \ref{compare_scatter})

<!-- * BunwrappJ: DEM_60_1_1 -->
<!-- * IMCORR: DEM_256_64_01 (because differnece in expert the expert approach to 256_128_01 is maginal) -->
<!-- * MAP of IMCORR / BUNWRAPP -->
<!-- * Scatterplot -->
<!-- * Raster Stats ( maybe in appendix, and delate other table there) -->

<!-- * Map -->
<!--   + Not possible of importing Arrows for flow direction (missing aspect of IMCORR, and i was not able to get the Arrows in a good Size for display) -->
<!--   + BunwarpJ -->
<!--     + Two main Areas of displacement -->
<!--     + The Displacement Zone at the Top of the tounge is a bit Stronger than the other one -->
<!--   + IMCORR -->
<!--     + Displacement on the hole tonge -->
<!--     + At the front of the Tonge the highest Displacement -->
<!--     + Error Displacement in the right lower corner - > not masked out like in the BunwarpJ -->
<!--     + At leat we can identify also two displacement zones, at the top and complete in the Front -->

<!-- * Raster Statistics -->
<!--   + BunwarpJ -->
<!--     + Min of 0.0006, Median of 0.6403, Max of 1.7188, IQR 0.5804 -->
<!--   + IMCORR -->
<!--     + Min pf 0.0007, Median of 0.8661, Max of 2.3810, IQR 0.9019 -->
<!--   + BunwarpJ have always lower displacement rates than IMCORR -->

```{r compare, echo=FALSE, fig.pos="h",fig.align="center", out.width = "500px", fig.cap= "Comparison of BUnwarpJ und IMCORR, final Results"}
knitr::include_graphics("images/Map_3.png")
```


```{r compare_scatter, echo=FALSE, fig.pos="h",fig.align="center", out.width = "300px", fig.cap= "Comparison of BUnwarpJ und IMCORR, final Results"}
knitr::include_graphics("images/Scatterplot.PNG")
```


```{r compare_stats,echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
text_tbl = read.csv(file = "tables/final_raster_stats.csv",header = T,sep = ";")
 knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Final Raster Statistics") %>% 
    kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>%
   column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue"
   # column_spec(2, width = "2.5cm") %>%
   # column_spec(3:18, width = "3cm") %>%
   row_spec(0, bold = TRUE) #%>%
   # row_spec(1, bold = TRUE) %>%
   # row_spec(12:13, bold = TRUE) %>%
   # row_spec(16, bold = TRUE) %>%
   # row_spec(27:28, bold = TRUE) %>%
   # kableExtra::landscape()
   
```

# Discussion
\vspace{-0.5cm}

<!-- * Final Results -->
<!--   + Discussion of Flow direction (?!) -->
<!--   + Plausibility of Results -->
<!--     + relativelly stable areas in BunwarpJ at the Front of the Tounge (real?!) -->
<!--     + unstable areas in Imcorr at the same possition (more real?!) -->
<!--     + Different Displacement zones (how does a rock glazier move-> wich one is more realistic?) -->
<!--   + Scatterplot?! -->
<!--     + What we can dicuss here?! -->
<!--   + Image Statistics -->
<!--     + Influenced image Statistic of IMCORR (lower right corner) -->
<!--     + IMCORR interpolation of Lines to Points to Image -->
<!--   + Visual comparison to Bodin et al. 2017 ?! -> recognize that bodin is 2m Resolution -->
  
Both algorithm results exhibit similar areas of maximum displacement at the rock glacier tongue when compared to previous work. However, BUnwarpJ results in relatively isolated areas of displacement, which we consider unrealistic. IMCORR, in comparison, results in smoother deformation velocities on the rock glacier tounge. However, the algorithm detects high displacement rates in areas of rockfall while BUnwarpJ automatically and correctly ignores those areas. The high displacement velocities at the steep front lobe of IMCORR seem to be more in accordance with real movements of falling boulders; BUnwarpJ detects hardly any displacement at the front lobe, instead.

With respect to the entire study area, we consider IMCORR results with a median displacement of 0.87m/a to be more in accordance with the validation data at hand as well with result maps in @bodin_multi-annual_2018, while BUnwarpJ slightly underestimates displacement velocities (median of 0.64m/a).

* validation data:

Although 

* assumptions and prerequisites of both algorithms
* -> sensitivity of BUnwarpJ and to a lesser degree of IMCORR on algorithm parameters
* BUnwarpJ not so dependent on input data sets (DEM, Hillshade or PCA) PCA from only Hillshade and DEM? Influence of image filtering?!
* Test III

* discuss validation data and data sets: small samples
* interpolated areal data vs. point data (COSP!)

* speed (BUnwarpJ) muchmuch faster
* BUnwarpJ rescaling to 8 bit input data necessary: loss of information -> this could also explain results in weighting factors! and: not so intuitive.


<!-- * Test I -->
<!--   + In both cases 60 Landmarks are showing the better values - > -->
<!--   + Explenation for R² of 0.0499 -->
<!--     + Valdidation points ( 3 to 4) of bodin are located in the Area of extreme Displacement (see fig. 1) -> our statistic colappses -->
<!--     + better R² for expert based Validaiton points, no point is located in the Area of extreme Displacement, but this is also showing a low R² -->
<!--   + Explenation for different RMSE -->
<!--     + Different number of samling Points -->
<!--     + Relativelly high RMSE for Bodin 60 Points ( in comparison to expert based) -->
<!--   + Conlusion -->
<!--     + 18 Sampling points are increasing the RMSE, Use at least a min. of 30 (or more?!) -->
<!--     + R² is not directly influenced by the numer of samling points -->
<!--     + Take care while collection Sampling Points ( valdidation) -->
<!--       + do not collect Sampling points on extremely moving (falling) rocks -->
<!--     + 61 Sampling points shows a high sensitivity to processes at the top (falling rocks) -->


<!-- * Test II -->
<!--   + In both cases the DEM as Transformation input is the right choice, but at leat i thing it doesn't matter if we use DEM, Hill or PC1 -->
<!--     + Aspect and Slope (can change easielly, at least there is not usefull information) -->
<!--     + DEM, Hillshade, PC1 within a 10% span, is it really significant?! -->
<!--   + Looking at the RMSE confirms the guess of Test I -->
<!--   + Conclusion -->
<!--     + Use the DEM as Input for the Transformation, with 60 LM (see test I) -->
<!--     + RMSE still higher for less Validation Points -->
<!--     + One Option could be to Calulate a PCA with the DEM and Hillshade ( both are showing strong correlation -> maybe we can get a higher R² and lower RMSE if we extract the Main Information from both Images) -->
    
* Test III
  + The best result is achieved with 1_1
  + Explenation for weighting 2 is better than 4
    + with the Weighting Factor of 4 the weight is overweighted?!
  + Explenation that LMW showing better Results than IMW
    + a bad Algorithem to for image comaprison (IMCOOR is showing better Results with just Image Comparing Test IV)
    + Convertion of Inputdata to 8 bit for ImageJ/Bunwarp -> loss of Data (especilly DEM originally 32 bit), is shout work with 32-bit data, but it didn't (BUG?!)

* Test IV
  + Best Result 256_64
    + Explenation ?! Smaller window size in Window?! Getting better the differeces?!
    



# Conclusion
\vspace{-0.5cm}
* Handling of Algorithms
  + IMCORR
    + High Processing Time with IMCORR, Interpolation (global, focal), no smooth Results (Bodin et al. Upsamling 2m)
    + Good Results (values), Visual not nice looking
  + BunwrapJ
    + "Resampling" to 8-bit as input image for ImageJ -> loss of information
    + ca. 20 min Transformation calculation (each test)
    + Use of R Script -> Process of Transformation (5-10 min each)
    + all in all high processing speed, good Results (Values as well as Image visuell)
* Both Algorithms suitable
* Future Research
  + Test Derivates with IMCORR
  + Test everything with COSI-Corr
  
\newpage

# Appendix
\vspace{-0.5cm}

```{r bunwarp_landmarks,echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
text_tbl = read.csv(file = "tables/T1_DEM_60_61_xyz_Bodin_manuell.csv",header = T,sep = ";")
 knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Result Statistics Test I") %>%
    kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down"))%>%
   column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue"
   column_spec(2, width = "2.5cm") %>%
   column_spec(3:6, width = "3cm") %>%
   row_spec(0, bold = TRUE) %>%
   row_spec(1, bold = TRUE) %>%
   row_spec(12:13, bold = TRUE) %>%
   row_spec(16, bold = TRUE) %>%
   row_spec(27:28, bold = TRUE)

```

```{r bunwarp_data,echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
text_tbl = read.csv(file = "tables/T2_diff_input_60_XYZ_bodin_manuell.csv",header = T,sep = ";")
 knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Resulting Statistics Test II") %>% 
    kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down"))%>%
   column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue"
   column_spec(2, width = "2.5cm") %>%
   column_spec(3:12, width = "3cm") %>%
   row_spec(0, bold = TRUE) %>%
   row_spec(1, bold = TRUE) %>%
   row_spec(12:13, bold = TRUE) %>%
   row_spec(16, bold = TRUE) %>%
   row_spec(27:28, bold = TRUE) %>%
   kableExtra::landscape()
   
```

```{r bunwarp_weights,echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
text_tbl = read.csv(file = "tables/T3_Settings_XYZ_Bodin_manuell_untereinander.csv",header = T,sep = ";")
 knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Resulting Statistics Test III") %>% 
    kableExtra::kable_styling(full_width = F, font_size = 12 , latex_options = c("striped","hold_position","scale_down"))%>%
   column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue"
   column_spec(2, width = "2.5cm") %>%
   column_spec(3:10, width = "3cm") %>%
   row_spec(0, bold = TRUE) %>%
   row_spec(1, bold = TRUE) %>%
   row_spec(12:13, bold = TRUE) %>%
   row_spec(16, bold = TRUE) %>%
   row_spec(28:29, bold = TRUE) %>%
   row_spec(32, bold = TRUE) %>%
   row_spec(43:44, bold = TRUE) %>%
   row_spec(47, bold = TRUE) %>%
   row_spec(58:59, bold = TRUE)
```


```{r imcorr,echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
text_tbl = read.csv(file = "tables/XYZ_IMCORR_Bodin_manuell_stats.csv",header = T,sep = ";")
 knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Resulting Statistics Test IV") %>% 
    kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down"))%>%
   column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue"
   column_spec(2, width = "2.5cm") %>%
   column_spec(3:18, width = "3cm") %>%
   row_spec(0, bold = TRUE) %>%
   row_spec(1, bold = TRUE) %>%
   row_spec(12:13, bold = TRUE) %>%
   row_spec(16, bold = TRUE) %>%
   row_spec(27:28, bold = TRUE) %>%
   kableExtra::landscape()
   
```



<!-- ```{r packages-tab6,echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- library(dplyr) -->
<!-- library(knitr) -->
<!-- library(kableExtra) -->
<!-- text_tbl = read.csv(file = "tables/T1_DEM_60_61_xyz_Raster_Stats.csv",header = T,sep = ";") -->
<!--  knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Raster Statistics Test I") %>%  -->
<!--     kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>% -->
<!--    column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue" -->
<!--    row_spec(0, bold = TRUE) %>% -->
<!--    # row_spec(1, bold = TRUE) %>% -->
<!--    # row_spec(12:13, bold = TRUE) %>% -->
<!--    # row_spec(16, bold = TRUE) %>% -->
<!--    # row_spec(27:28, bold = TRUE) %>% -->
<!--    kableExtra::landscape() -->

<!-- ``` -->


<!-- ```{r packages-tab7,echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- library(dplyr) -->
<!-- library(knitr) -->
<!-- library(kableExtra) -->
<!-- text_tbl = read.csv(file = "tables/T2_diff_input_60_raster_stats.csv",header = T,sep = ";") -->
<!--  knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Raster Statistics Test I") %>%  -->
<!--     kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>% -->
<!--    column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue" -->
<!--    row_spec(0, bold = TRUE) %>% -->
<!--    # row_spec(1, bold = TRUE) %>% -->
<!--    # row_spec(12:13, bold = TRUE) %>% -->
<!--    # row_spec(16, bold = TRUE) %>% -->
<!--    # row_spec(27:28, bold = TRUE) %>% -->
<!--    kableExtra::landscape() -->

<!-- ``` -->


<!-- ```{r packages-tab8,echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- library(dplyr) -->
<!-- library(knitr) -->
<!-- library(kableExtra) -->
<!-- text_tbl = read.csv(file = "tables/T3_Settings_raster_stats.csv",header = T,sep = ";") -->
<!--  knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Raster Statistics Test II") %>%  -->
<!--     kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>% -->
<!--    column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue" -->
<!--    row_spec(0, bold = TRUE) %>% -->
<!--    # row_spec(1, bold = TRUE) %>% -->
<!--    # row_spec(12:13, bold = TRUE) %>% -->
<!--    # row_spec(16, bold = TRUE) %>% -->
<!--    # row_spec(27:28, bold = TRUE) %>% -->
<!--    kableExtra::landscape() -->

<!-- ``` -->


<!-- ```{r packages-tab9,echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- library(dplyr) -->
<!-- library(knitr) -->
<!-- library(kableExtra) -->
<!-- text_tbl = read.csv(file = "tables/T3_Settings_raster_stats.csv",header = T,sep = ";") -->
<!--  knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Raster Statistics Test III") %>%  -->
<!--     kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>% -->
<!--    column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue" -->
<!--    row_spec(0, bold = TRUE) %>% -->
<!--    # row_spec(1, bold = TRUE) %>% -->
<!--    # row_spec(12:13, bold = TRUE) %>% -->
<!--    # row_spec(16, bold = TRUE) %>% -->
<!--    # row_spec(27:28, bold = TRUE) %>% -->
<!--    kableExtra::landscape() -->

<!-- ``` -->




<!-- ```{r packages-tab10,echo=FALSE, warning=FALSE, message=FALSE} -->
<!-- library(dplyr) -->
<!-- library(knitr) -->
<!-- library(kableExtra) -->
<!-- text_tbl = read.csv(file = "tables/XYZ_IMCORR_raster_stats.csv",header = T,sep = ";") -->
<!--  knitr::kable(text_tbl, format = "latex", booktabs = TRUE, caption = "Raster Statistics Test IV") %>%  -->
<!--     kableExtra::kable_styling(full_width = F, font_size = 10 , latex_options = c("striped","hold_position","scale_down")) %>% -->
<!--    column_spec(1, bold = TRUE, width = "2cm") %>%  #color = "blue" -->
<!--    row_spec(0, bold = TRUE) %>% -->
<!--    # row_spec(1, bold = TRUE) %>% -->
<!--    # row_spec(12:13, bold = TRUE) %>% -->
<!--    # row_spec(16, bold = TRUE) %>% -->
<!--    # row_spec(27:28, bold = TRUE) %>% -->
<!--    kableExtra::landscape() -->

<!-- ``` -->

\newpage

# References
\vspace{-0.5cm}


